components_manager:
  task_processors:
    main-task-processor:
      worker_threads: 4

    fs-task-processor:
      worker_threads: 1

  components:
    server:
      listener:
        port: 8080

    logging:
      loggers:
        default:
          file_path: '/logs/api.log'
          level: debug
          overflow_behavior: discard

    work-holder:
      checker-addr#env: CHECKER_ADDR
      checker-addr#fallback: tcp://checker:55555

    pg-database:
      dbconnection#env: POSTGRES_DB_CONNECTION
      dbconnection#fallback: postgresql://-admin:qwerty@postgres:5432/workHosting
      blocking_task_processor: fs-task-processor
      dns_resolver: async

    redis-cache:
      groups:
        - config_name: cache
          db: api_cache_db
          sharding_strategy: RedisStandalone
      subscribe_groups:
        - config_name: cache
          db: api_cache_db
          sharding_strategy: RedisStandalone
      thread_pools:
        redis_thread_pool_size: 4
        sentinel_thread_pool_size: 1

    testsuite-support:

    default-secdist-provider:
      config: /etc/api/secure_data.json

    send-work-handler:
      path: /send
      method: POST
      task_processor: main-task-processor
      send-timeout-ms#env: SEND_TIMEOUT_MS
      send-timeout-ms#fallback: 60000
      auth:
        types:
          - bearer
        scopes:
          - student

    register-handler:
      path: /register
      method: POST
      task_processor: main-task-processor
      admin-username#env: ADMIN_USERNAME
      admin-username#fallback: admin
      admin-password#env: ADMIN_PASSWORD
      admin-password#fallback: qwerty

    login-handler:
      path: /login
      method: POST
      task_processor: main-task-processor
      token-ttl#env: TOKEN_TTL
      token-ttl#fallback: 360000

    student-profile-handler:
      path: /student/profile
      method: GET
      task_processor: main-task-processor
      auth:
        types:
          - bearer
        scopes:
          - student

    get-works-handler:
      path: /works
      method: GET
      task_processor: main-task-processor

    get-checking-queue-handler:
      path: /queue
      method: GET
      task_processor: main-task-processor

    pop-checking-queue-handler:
      path: /admin/queue
      method: DELETE
      task_processor: main-task-processor
      auth:
        types:
          - bearer
        scopes:
          - admin

    get-marks-handler:
      path: /student/marks
      method: GET
      task_processor: main-task-processor
      auth:
        types:
          - bearer
        scopes:
          - student

    user-role-handler:
      path: /user/role
      method: GET
      task_processor: main-task-processor

    hello-handler:
      path: /testing/hello
      method: GET
      auth:
        types:
          - bearer
        scopes:
          - hello

    checking-queue-updater:
      task_processor: main-task-processor
      listen-addr#env: CHECKING_QUEUE_UPDATER_LISTEN_ADDR
      listen-addr#fallback: tcp://*:55555
      recieve-timeout-ms#env: CHECKING_QUEUE_UPDATER_TIMEOUT_MS
      recieve-timeout-ms#fallback: 3000

