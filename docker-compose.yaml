services:
  # postgres:
  #   image: postgres:latest
  #   restart: always
  #   environment:
  #     POSTGRES_PASSWORD: "${POSTGRES_PASSWORD:-qwerty}"
  #     POSTGRES_USER: "${POSTGRES_USER:-admin}"
  #     POSTGRES_DB: "workHosting"
  #   volumes:
  #     - "./init/pg:/docker-entrypoint-initdb.d:ro"
  #     - "${STORAGE_PATH:-/tmp}/postgres:/var/lib/postgresql"
  #   networks:
  #     - backend-1

  api:
    build:
      context: .
      dockerfile: ./docker/api.dockerfile
    environment:
      CHECKER_ADDR: "tcp://checker:55555"
    volumes:
      - "${LOG_PATH:-/tmp}/api/:/logs/"
    ports:
      - "8080:8080"
    security_opt:
      - seccomp=unconfined
    depends_on:
      - checker
      # - postgresql
    networks:
      - backend-1
      - backend-2

  checker:
    build:
      context: .
      dockerfile: ./docker/checker.dockerfile
    environment:
      CHECKER_ADDR: "tcp://checker:55555"
      LOG_PATH: "/logs/checker.log"
    volumes:
      - "${STORAGE_PATH:-/tmp}/checker:/checker"
      - "${LOG_PATH:-/tmp}/checker:/logs"
      - "${HOME}/.ssh:/home/checker/.ssh:ro"
      - "./backend/scripts:/scripts"
      - "./init/checker/init.sh:/init.sh"
    networks:
      - backend-2

networks:
  backend-1:
    driver: bridge

  backend-2:
    driver: bridge
